default_platform(:ios)

platform :ios do
  desc "Deploy a new version to the App Store"
  lane :release do
    match(type: "appstore", readonly: true)      # Use match for code signing
    build_ios_app(
      scheme: "Runner",
      export_options: "ExportOptions.plist",
      xcargs: "-allowProvisioningUpdates"
    )
    upload_to_testflight(skip_waiting_for_build_processing: true)
    deliver(force: false)
  end
end
